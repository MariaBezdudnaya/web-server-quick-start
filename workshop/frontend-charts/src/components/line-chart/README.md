# LineChart
[Назад](../../README.md)

`LineChart` это класс в JavaScript, создающий линейную диаграмму с использованием D3.js.

## Описание

Класс `LineChart` берет данные через API запрос и создает линейную диаграмму.

- Конструктор класса `constructor` принимает значения стилей и шаблона, а также инжектирует сервисы `ChartDataService` и `ApiService`.
- Метод `onAttributeChange` обрабатывает изменение атрибутов, подписывая данные на сервис `ChartDataService`.
- Метод `initData` запрашивает данные из заданного URL и передает их в функцию `createChart`.
- Метод `createChart` создает линейную диаграмму с использованием привязанных данных. Он отвечает за очистку элемента диаграммы, создание диаграммы, анимации, создание осей X и Y и добавление фокуса.
- `onDisconnect` отвечает за отписку от получения данных при разрыве связи.

## Использование

```js
import { LineChart } from './LineChart.js';

let lineChart = new LineChart();
document.body.appendChild(lineChart);
```

В этом примере создается новый экземпляр `LineChart` и добавляет его в `body` HTML документа.

## Методы

### onAttributeChange(name, oldValue, newValue)
Обрабатывает изменение атрибутов, подписывая данные на сервис `ChartDataService`.

### initData(config)
Запрашивает данные из заданного URL и передает их в функцию `createChart`.

### onDisconnect
Отписывается от получения данных при разрыве связи.

### createChart(data)
Создает линейную диаграмму с использованием привязанных данных. Он отвечает за очистку элемента диаграммы, создание диаграммы, анимации, создание осей X и Y и добавление фокуса.

Примечание: Создание нового экземпляра `LineChart` и добавление его в `body` HTML документа приведет к созданию элемента HTML и креплению линейной диаграммы.

# lineChartTemplate

`lineChartTemplate` это функция в JavaScript, которая генерирует шаблон для линейной диаграммы.

## Описание

Функция `lineChartTemplate` принимает объект конфигурации и возвращает HTML-строку, которая задает структуру для линейной диаграммы.

- Она принимает аргумент `{rootClass}`, который определяет CSS класс для div-контейнера диаграммы.

## Использование

```js
const template = lineChartTemplate({rootClass: 'my-line-chart'});
console.log(template); // вывод: '<div class="my-line-chart"></div>'
```

В этом примере, функция `lineChartTemplate` получает объект с свойством `rootClass`, установленным в 'my-line-chart', и возвращает строку `<div class="my-line-chart"></div>`, которая может служить контейнером для линейной диаграммы.

## Возвращаемое значение

Возвращаемое значение `lineChartTemplate` - это HTML-строка, которая определяет div-контейнер для линейной диаграммы. CSS класс этого контейнера устанавливается в значение `rootClass` переданного объекта конфигурации.

## Примечания

- Эта функция не создает саму диаграмму; она только преобразует объект конфигурации в HTML-разметку. Создание самой диаграммы выполняется с помощью отдельной функции, такой как `createLineChart`.
- Пример описания объекта конфигурации `{rootClass: 'my-line-chart'}`. `rootClass` - это класс CSS, который будет присвоен div-контейнеру диаграммы. Вы можете использовать любое имя CSS класса, которое подходит для вашего конкретного случая использования.

# createLineChart

`createLineChart` - это функция на языке JavaScript, которая создает линейную диаграмму на основе предоставленных данных и HTML-элемента.

## Описание

Функция `createLineChart` принимает два аргумента: массив данных и HTML-элемент. Далее на основе этих данных строится линейная диаграмма SVG с помощью библиотеки D3.js.

- Размеры и отступы диаграммы задаются в начале функции.
- Затем создаются шкалы для осей X и Y, и их диапазоны устанавливаются на основании входных данных.
- После этого создается SVG-элемент внутри переданного элемента и применяются необходимые стили.
- Линия диаграммы задается с использованием метода `line` из D3, а ее координаты X и Y сопоставляются с масштабом осей.
- Наконец, к SVG-элементу добавляются оси X и Y, анимация и установлен фокус.

## Использование

```js
createLineChart(data, document.querySelector('.my-line-chart'));
```

В этом примере функция `createLineChart` вызывается с массивом `data` и div-элементом с классом 'my-line-chart'. В результате в этом div-элементе создается линейная диаграмма.

## Возвращаемое значение

Функция возвращает объект с методами: `withAnimation` подготавливает анимацию для диаграммы, `createXAxis` и `createYAxis` создают оси X и Y, а `withFocus` позволяет установить фокус на определенную область диаграммы.

## Примечания

- Функция предназначена для использования с библиотекой D3.js.
- Входные данные должны быть в формате, пригодном для D3.js, обычно это массив пар значений.
- На входе функция ожидает, что элемент для диаграммы уже присутствует в DOM.
- Функция мутирует переданный HTML-элемент, создавая внутри него SVG-элементы и применяя стили.
- Убедитесь, что при передаче элемента в функцию его размеры позволяют вместить диаграмму с установленными размерами и отступами.

# withFocus

`withFocus` - это функция на языке JavaScript, предназначенная для добавления маркера фокуса и всплывающей подсказки для линейной диаграммы, созданной библиотекой D3.js.

## Описание

Функция `withFocus` принимает шесть аргументов: SVG-элемент (`svg`), ширину диаграммы (`width`), высоту диаграммы (`height`), масштаб оси X (`xScale`), массив данных (`data`) и масштаб оси Y (`yScale`).

Внутри функции создается новый SVG-групповой элемент (`g`) специально для фокуса. К этому групповому элементу добавляются две прерывистые линии (по горизонтали и вертикали) и круг, которые будут показывать место фокуса на графике..

Также создается всплывающая подсказка, которая будет отображать данные в точке фокуса.

Функции `mouseover`, `mouseout` и `mousemove` вешаются на элемент svg. Они реагируют на перемещение мыши, показывают и скрывают элементы фокуса и обновляют их положение.

## Использование

```js
withFocus(svg, width, height, xScale, data, yScale);
```

В этом примере `withFocus` вызывается с созданным SVG-элементом, заданными размерами диаграммы, масштабами осей и массивом данных. Он добавит на диаграмму функциональность фокусировки.

## Примечания

- Функция предназначена для использования вместе с `createLineChart` и библиотекой D3.js.
- Функция модифицирует переданный SVG-элемент, добавляя в него новые элементы для фокусировки и показа всплывающих подсказок.
- Код функции `calculateFocusPosition` в примере не определен. Эта функция должна вычислять положение маркера фокуса и всплывающей подсказки на основе текущего положения мыши.

# calculateFocusPosition()

Функция `calculateFocusPosition()` это вспомогательная функция, используемая в процессе создания интерактивных линейных диаграмм. Задача данной функции - вычислить позицию фокуса на диаграмме при событии наведения.

## Описание

Функция принимает объект события в качестве аргумента. Она вычисляет позицию на оси X, на которую указывает мышь, и находит две ближайшие точки данных к этой позиции - одну слева и одну справа.

На основании этих данных вычисляется позиция фокуса. Если мышь ближе к точке данных справа, то фокус позиционируется на этой точке, иначе - на точке слева.

Функция затем обновляет атрибуты 'transform' у элементов фокуса (точка, горизонтальная и вертикальная линии), перемещая их в новую позицию.

Также обновляется текст подсказки (tooltip) и меняются размеры и позиция прямоугольника подсказки.

Если подсказка выходит за пределы диаграммы, её позиция корректируется.

## Использование

Функция `calculateFocusPosition` обычно используется как обработчик событий при наведении мыши на диаграмму.

```js
svg.on('mousemove', calculateFocusPosition);
```

## Возвращаемое значение

Функция не возвращает значение.

## Примечания

* Функция разработана для использования вместе с библиотекой d3.js.
* Объект события, переданный в `calculateFocusPosition`, должен быть событием 'mousemove'.
* Функция модифицирует DOM, обновляя атрибуты элементов фокуса и подсказки.

# withAnimation

`withAnimation` - это функция, которая предоставляет анимацию для SVG-пути.

## Описание

Функция `withAnimation` принимает один аргумент, именно SVG-путь, к которому надо применить анимацию. Эта анимация создается с помощью использования `stroke-dasharray` и `stroke-dashoffset` свойств SVG.

- Изначально на пути создается "пунктир", равный общей длине пути.
- Затем этот "пунктир" смещается на общую длину пути, создавая иллюзию пустого пути.
- В процессе анимации смещение уменьшается до нуля, делая видимым весь путь, что создает эффект рисования пути.

## Использование

```js
const path = svg.append('path')...; 
const animatedPath = withAnimation(path);

animatedPath();
```

## Возвращаемое значение

Функция возвращает функцию, которая при вызове применяет анимацию к переданному в нее пути.

## Примечания

- Длительность анимации заранее установлена в 2000 мс (2 секунды), и это значение не может быть изменено в текущей реализации функции. Если потребуется другая длительность анимации, необходимо изменить эту функцию.
- Функция возвращает новую функцию, которую необходимо вызвать, чтобы начать анимацию.
- Это функция не должна вызываться вместе с другими функциями работы с SVG, которые могут изменить общую длину пути, иначе анимация не будет работать корректно.

# createXAxis, createYAxis и createAxis

`createXAxis`, `createYAxis` и `createAxis` — это функции, используемые для создания прорисованного и стилизованного графика осей X и Y.

## createXAxis

Функция `createXAxis` создает график оси X.

### Описание

Функция принимает три аргумента: `svg` (svg-элемент, на котором будет создан график), `xScale` (масштаб, используемый для определения позиций на оси X) и `height` (высота svg-элемента).

### Использование

```js
const xAxis = createXAxis(svg, xScale, height);
xAxis();
```

## createYAxis

Функция `createYAxis` создает график оси Y.

### Описание

Функция принимает два аргумента: `svg` (svg-элемент, на котором будет создан график) и `yScale` (масштаб, используемый для определения позиций на оси Y).

### Использование

```js
const yAxis = createYAxis(svg, yScale);
yAxis();
```

## createAxis

`createAxis` - это вспомогательная функция, используемая createXAxis и createYAxis для реального создания и стилизации графика.

### Описание

Функция принимает два аргумента:
- `scale` (масштаб, используемый для определения позиций на оси)
- `svg` (svg-элемент, на котором будет создан график).

Функция настраивает стили текста, линий и кругов оси, а также общий стиль оси.

### Использование

```js
const axis = createAxis(scale, svg);
```

## Возвращаемые значения

Функции `createXAxis` и `createYAxis` возвращают функцию, которую необходимо вызвать для применения создания и стилизации оси.

Функция `createAxis` возвращает созданную и стилизованную ось.

## Примечания

- Функции разработаны для использования вместе с библиотекой d3.js.
- Функция `createAxis` изменяет DOM, обновляя атрибуты и стили svg-элементов.